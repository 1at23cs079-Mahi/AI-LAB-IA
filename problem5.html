<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem 5: Forest Fire Escape Planner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <style>
        body { background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.9; } }
        .problem-container { background: #1a0000; color: #ffcccc; border: 4px solid #ff4444; box-shadow: 0 0 40px rgba(255, 68, 68, 0.6); }
        .back-button { background: #ff4444; color: white; border-radius: 30px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .back-button:hover { background: #ff0000; box-shadow: 0 0 20px rgba(255, 68, 68, 0.8); }
        .problem-header { border-bottom: 3px solid #ff4444; background: linear-gradient(135deg, #330000 0%, #1a0000 100%); }
        .problem-header h1 { color: #ff6666; text-shadow: 0 0 10px rgba(255, 102, 102, 0.5); }
        .controls { background: #330000; border: 2px solid #ff4444; }
        .controls h3 { color: #ff6666; }
        .btn { background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 0, 0, 0.7); }
        .btn-secondary { background: #660000; color: #ff6666; border: 2px solid #ff4444; }
        .output { background: #1a0000; border: 3px solid #ff4444; }
        .cell { background: #330000; border: 1px solid #ff4444; }
        .cell.fire { background: #ff0000; animation: flicker 0.5s infinite; }
        @keyframes flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
    <div class="problem-container">
        <a href="index.html" class="back-button">‚Üê Back to Home</a>
        
        <div class="problem-header">
            <h1>üî• Problem 5: Forest Fire Escape Planner</h1>
            <p class="description">
                Plan a safe path for a hiker from start to exit before fire blocks all paths. Fire spreads each minute.
            </p>
        </div>

        <div class="controls">
            <h3>Forest Configuration (6√ó6 Grid)</h3>
            <div class="control-group">
                <label>Click cells to set fire sources (red), obstacles (black), or clear (white)</label>
                <div id="gridSetup" class="visualization"></div>
            </div>
            <button class="btn" onclick="findEscapePath()">Find Escape Path</button>
            <button class="btn" onclick="animate()">Animate Fire Spread</button>
            <button class="btn btn-secondary" onclick="resetForest()">Reset</button>
        </div>

        <div id="output" class="output" style="display:none;">
            <h3>Escape Plan</h3>
            <div id="resultContent"></div>
            <div class="visualization">
                <div id="animationContainer"></div>
            </div>
            <div class="stats" id="stats"></div>
        </div>
    </div>

    <script>
        const SIZE = 6;
        let grid = [];
        let fireStart = [{x: 2, y: 2}, {x: 4, y: 4}];
        let start = {x: 0, y: 0};
        let exit = {x: 5, y: 5};

        function initGrid() {
            grid = Array(SIZE).fill(null).map(() => Array(SIZE).fill(0));
            fireStart.forEach(f => grid[f.x][f.y] = 2); // 2 = fire
            grid[1][2] = grid[3][1] = 1; // obstacles
            renderGrid();
        }

        function renderGrid() {
            const container = document.getElementById('gridSetup');
            const gridDiv = document.createElement('div');
            gridDiv.className = 'grid';
            gridDiv.style.gridTemplateColumns = `repeat(${SIZE}, 1fr)`;
            gridDiv.innerHTML = '';
            
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.onclick = () => {
                        if ((i === start.x && j === start.y) || (i === exit.x && j === exit.y)) return;
                        grid[i][j] = (grid[i][j] + 1) % 3;
                        renderGrid();
                    };
                    
                    if (i === start.x && j === start.y) {
                        cell.classList.add('start');
                        cell.textContent = 'S';
                    } else if (i === exit.x && j === exit.y) {
                        cell.classList.add('goal');
                        cell.textContent = 'E';
                    } else if (grid[i][j] === 1) {
                        cell.classList.add('obstacle');
                    } else if (grid[i][j] === 2) {
                        cell.classList.add('fire');
                        cell.textContent = 'üî•';
                    }
                    
                    gridDiv.appendChild(cell);
                }
            }
            container.innerHTML = '';
            container.appendChild(gridDiv);
        }

        function spreadFire(currentGrid) {
            const newGrid = currentGrid.map(row => [...row]);
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    if (currentGrid[i][j] === 2) {
                        [[0,1],[1,0],[0,-1],[-1,0]].forEach(([dx,dy]) => {
                            const ni = i + dx, nj = j + dy;
                            if (ni >= 0 && ni < SIZE && nj >= 0 && nj < SIZE && currentGrid[ni][nj] === 0) {
                                newGrid[ni][nj] = 2;
                            }
                        });
                    }
                }
            }
            return newGrid;
        }

        function findEscapePath() {
            const fireTimeline = [grid.map(row => [...row])];
            for (let t = 0; t < 10; t++) {
                fireTimeline.push(spreadFire(fireTimeline[fireTimeline.length - 1]));
            }

            // BFS with time dimension
            const queue = [{pos: start, time: 0, path: [start]}];
            const visited = new Set([`${start.x},${start.y},0`]);

            while (queue.length > 0) {
                const {pos, time, path} = queue.shift();

                if (pos.x === exit.x && pos.y === exit.y) {
                    displayResult(path, time, fireTimeline);
                    return;
                }

                if (time + 1 >= fireTimeline.length) continue;

                [[0,1],[1,0],[0,-1],[-1,0]].forEach(([dx,dy]) => {
                    const nx = pos.x + dx, ny = pos.y + dy;
                    const nextTime = time + 1;
                    const key = `${nx},${ny},${nextTime}`;

                    if (nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && 
                        !visited.has(key) &&
                        fireTimeline[nextTime][nx][ny] === 0) {
                        visited.add(key);
                        queue.push({pos: {x: nx, y: ny}, time: nextTime, path: [...path, {x: nx, y: ny}]});
                    }
                });
            }

            document.getElementById('output').style.display = 'block';
            document.getElementById('resultContent').innerHTML = `
                <div class="alert alert-error">‚úó No escape path found! Fire spreads too fast.</div>
            `;
        }

        function displayResult(path, time, fireTimeline) {
            const output = document.getElementById('output');
            const resultContent = document.getElementById('resultContent');
            const stats = document.getElementById('stats');
            
            output.style.display = 'block';
            
            resultContent.innerHTML = `
                <div class="alert alert-success">‚úì Safe escape path found! Time to exit: ${time} minutes</div>
            `;

            stats.innerHTML = `
                <div class="stat-card">
                    <div class="label">Path Length</div>
                    <div class="value">${path.length}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Time to Exit</div>
                    <div class="value">${time} min</div>
                </div>
                <div class="stat-card">
                    <div class="label">Safety Margin</div>
                    <div class="value">${10 - time} min</div>
                </div>
            `;
        }

        function resetForest() {
            initGrid();
            document.getElementById('output').style.display = 'none';
        }

        initGrid();
    </script>
</body>
</html>
